tasks:
  -
    name: main
    default: true
    language: Bash
    config:
      version: 2022.07
    code: |
      set -e

      version=$(config version)
      echo "Use rakudo version: $version"
      eval $(~/.rakubrew/bin/rakubrew init Bash)
      rakubrew download moar-$version
      rakubrew switch moar-$version

      cd source
      which zef
      which raku
      raku --version
      zef --version

      zef update 
      zef install --/test .

    depends:
      -
        name: rakubrew-install
  -
    name: rakubrew-install
    language: Bash
    code: |
      set -e
      curl https://rakubrew.org/install-on-perl.sh | sh
